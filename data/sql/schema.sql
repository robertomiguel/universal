CREATE TABLE consulta (id BIGINT AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL, telefono VARCHAR(30), email VARCHAR(50) NOT NULL, plan_id BIGINT NOT NULL, consulta VARCHAR(255), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE cuota (id BIGINT AUTO_INCREMENT, suscripcion_id BIGINT NOT NULL, nro_cuota BIGINT NOT NULL, importe DECIMAL(10, 2) DEFAULT 0, femision DATE, fvencimiento DATE, fpago DATE, impresa TINYINT(1) DEFAULT '0' NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX suscripcion_id_idx (suscripcion_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE localidad (id BIGINT AUTO_INCREMENT, provincia_id BIGINT NOT NULL, nombre VARCHAR(50) NOT NULL, cp VARCHAR(4) NOT NULL, INDEX provincia_id_idx (provincia_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE plan (id BIGINT AUTO_INCREMENT, rubro_id BIGINT NOT NULL, visto BIGINT, descripcion VARCHAR(100) NOT NULL, valor_cuota DECIMAL(10, 2) DEFAULT 0, foto VARCHAR(250) NOT NULL, info_url VARCHAR(250) NOT NULL, mostrar TINYINT(1) DEFAULT '0' NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX rubro_id_idx (rubro_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE productor (id BIGINT AUTO_INCREMENT, localidad_id BIGINT NOT NULL, codigo VARCHAR(10) UNIQUE, zona VARCHAR(20), apellido VARCHAR(50) NOT NULL, nombre VARCHAR(50) NOT NULL, domicilio VARCHAR(100) NOT NULL, tel VARCHAR(20), celular VARCHAR(20), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX localidad_id_idx (localidad_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE provincia (id BIGINT AUTO_INCREMENT, nombre VARCHAR(50) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE rubro (id BIGINT AUTO_INCREMENT, nombre VARCHAR(50) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_forgot_password (id BIGINT AUTO_INCREMENT, user_id BIGINT NOT NULL, unique_key VARCHAR(255), expires_at DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group_permission (group_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_permission (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_remember_key (id BIGINT AUTO_INCREMENT, user_id BIGINT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user (id BIGINT AUTO_INCREMENT, first_name VARCHAR(255), last_name VARCHAR(255), email_address VARCHAR(255) NOT NULL UNIQUE, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active TINYINT(1) DEFAULT '1', is_super_admin TINYINT(1) DEFAULT '0', last_login DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_group (user_id BIGINT, group_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_permission (user_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, permission_id)) ENGINE = INNODB;
CREATE TABLE suscripcion (id BIGINT AUTO_INCREMENT, fecha_alta DATE, fecha_vence DATE, fecha_baja DATE, nro BIGINT UNIQUE NOT NULL, suscriptor_id BIGINT NOT NULL, productor_id BIGINT NOT NULL, codigo VARCHAR(5), diacobro VARCHAR(50), plan VARCHAR(100) NOT NULL, valor_cuota DECIMAL(10, 2) DEFAULT 0, cant_cuotas BIGINT DEFAULT 0, sorteo VARCHAR(3), obs VARCHAR(255), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX suscriptor_id_idx (suscriptor_id), INDEX productor_id_idx (productor_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE suscriptor (id BIGINT AUTO_INCREMENT, localidad_id BIGINT NOT NULL, dni VARCHAR(8) NOT NULL UNIQUE, apellido VARCHAR(50) NOT NULL, nombre VARCHAR(50) NOT NULL, domicilio VARCHAR(100) NOT NULL, tel VARCHAR(30), celular VARCHAR(30), conyuge VARCHAR(100), activo TINYINT(1) DEFAULT '1' NOT NULL, obs VARCHAR(255), sf_guard_user_id BIGINT, usr_nombre VARCHAR(50), usr_clave VARCHAR(50), usr_recordar_token VARCHAR(100), usr_estado BIGINT, usr_permiso BIGINT, usr_grupo BIGINT, usr_fecha_acceso DATE, usr_ip VARCHAR(20), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX sf_guard_user_id_idx (sf_guard_user_id), INDEX localidad_id_idx (localidad_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE usuario (id BIGINT AUTO_INCREMENT, nombre VARCHAR(50) NOT NULL, sf_guard_user_id BIGINT, INDEX sf_guard_user_id_idx (sf_guard_user_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE cuota ADD CONSTRAINT cuota_suscripcion_id_suscripcion_id FOREIGN KEY (suscripcion_id) REFERENCES suscripcion(id) ON DELETE CASCADE;
ALTER TABLE localidad ADD CONSTRAINT localidad_provincia_id_provincia_id FOREIGN KEY (provincia_id) REFERENCES provincia(id) ON DELETE CASCADE;
ALTER TABLE plan ADD CONSTRAINT plan_rubro_id_rubro_id FOREIGN KEY (rubro_id) REFERENCES rubro(id) ON DELETE CASCADE;
ALTER TABLE productor ADD CONSTRAINT productor_localidad_id_localidad_id FOREIGN KEY (localidad_id) REFERENCES localidad(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_forgot_password ADD CONSTRAINT sf_guard_forgot_password_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE suscripcion ADD CONSTRAINT suscripcion_suscriptor_id_suscriptor_id FOREIGN KEY (suscriptor_id) REFERENCES suscriptor(id) ON DELETE CASCADE;
ALTER TABLE suscripcion ADD CONSTRAINT suscripcion_productor_id_productor_id FOREIGN KEY (productor_id) REFERENCES productor(id) ON DELETE CASCADE;
ALTER TABLE suscriptor ADD CONSTRAINT suscriptor_sf_guard_user_id_sf_guard_user_id FOREIGN KEY (sf_guard_user_id) REFERENCES sf_guard_user(id);
ALTER TABLE suscriptor ADD CONSTRAINT suscriptor_localidad_id_localidad_id FOREIGN KEY (localidad_id) REFERENCES localidad(id) ON DELETE CASCADE;
ALTER TABLE usuario ADD CONSTRAINT usuario_sf_guard_user_id_sf_guard_user_id FOREIGN KEY (sf_guard_user_id) REFERENCES sf_guard_user(id);
